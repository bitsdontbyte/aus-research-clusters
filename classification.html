<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cluster Theme Classification</title>

<link href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin:16px; }
  .controls { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
  #table { border:1px solid #e5e7eb; }

  /* compact rows */
  .tabulator-row { min-height: 0; }
  .tabulator-cell { padding: 2px 6px; }

  /* wrapped cells */
  .wrap-cell {
    white-space: normal !important;
    overflow-wrap: anywhere;
    line-height: 1.2;
    margin: 0;
  }

  input,button,select { padding:6px 10px; }
</style>

<body>
  <h1>Cluster Theme Classification</h1>

  <div class="controls">
    <input id="search" type="text" placeholder="Type to search">
    <select id="page-size">
      <option value="10">10 rows</option>
      <option value="25">25 rows</option>
      <option value="50">50 rows</option>
      <option value="100">100 rows</option>
    </select>
    <button id="download-xlsx">Download Excel</button>
    <button id="download-csv">Download CSV</button>
    <button id="clear">Clear filters</button>
  </div>

  <div id="table"></div>

<script>
function esc(s){ return String(s??"").replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])); }
function wrapFormatter(cell){ return `<div class="wrap-cell">${esc(cell.getValue())}</div>`; }

// JSON keys expected: cluster_id, theme_id, explanation, title, abstract
const columns = [
  {title:"Cluster ID", field:"cluster_id", sorter:"number", headerFilter:"input", width:100},
  {title:"Theme ID", field:"theme_id", sorter:"number", headerFilter:"input", width:100},
  {title:"Explanation", field:"explanation", sorter:"string", headerFilter:"input",
    formatter:wrapFormatter, widthGrow:3},
  {title:"Title", field:"title", sorter:"string", headerFilter:"input",
    formatter:wrapFormatter, widthGrow:2},
  {title:"Abstract", field:"abstract", sorter:"string", headerFilter:"input",
    formatter:wrapFormatter, widthGrow:4},
];

const table = new Tabulator("#table", {
  height:"70vh",
  layout:"fitDataStretch",
  ajaxURL:"classification.json", // your exported JSON
  pagination:true,
  paginationSize:25,
  paginationSizeSelector:[10,25,50,100],
  columns,
  columnDefaults:{ vertAlign:"top" },
  variableHeight:true,          // let rows grow only when needed
  renderVertical:"basic"        // disable virtual height caching â†’ removes extra blank space
});

// global search
const searchInput = document.getElementById("search");
searchInput.addEventListener("input", () => {
  const q = searchInput.value.trim();
  if (!q) { table.clearFilter(true); return; }
  const fields = columns.map(c => c.field);
  table.setFilter(fields.map(f => ({field:f, type:"like", value:q})), "or");
});

// page size
document.getElementById("page-size").addEventListener("change", e => {
  table.setPageSize(parseInt(e.target.value,10));
});

// downloads
document.getElementById("download-xlsx").addEventListener("click", () => {
  table.download("xlsx", "cluster_theme_classification.xlsx", {sheetName:"Data"});
});
document.getElementById("download-csv").addEventListener("click", () => {
  table.download("csv", "cluster_theme_classification.csv");
});

// clear filters
document.getElementById("clear").addEventListener("click", () => {
  searchInput.value = "";
  table.clearFilter(true);
});
</script>
</body>
</html>
