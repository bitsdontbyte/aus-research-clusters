<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cluster Theme Classification</title>

<link href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin:16px; }
  .controls { display:flex; gap:8px; flex-wrap:wrap; margin:10px 0; }
  #table { border:1px solid #e5e7eb; }

  /* Compact rows + clamp long text so rows don't explode */
  .tabulator-row .tabulator-cell { padding-top:6px; padding-bottom:6px; }
  .tabulator-cell { vertical-align: top; } /* top-align multi-line cells */

  .truncate-2, .truncate-3, .truncate-4 {
    white-space: normal !important;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .truncate-2 { -webkit-line-clamp: 2; }
  .truncate-3 { -webkit-line-clamp: 3; }
  .truncate-4 { -webkit-line-clamp: 4; }

  input,button,select { padding:6px 10px; }

  /* simple top bar with Home link */
  .topbar { display:flex; align-items:center; justify-content:flex-start; margin-bottom:8px; }
  .home-btn { text-decoration:none; font-weight:600; border:1px solid #e5e7eb; padding:6px 10px; border-radius:6px; }
  .home-btn:hover { background:#f3f4f6; }
  
  /* Thin divider between rows */
	#table .tabulator-row {
	  border-bottom: 2px solid #000000 !important; /* light gray line */
	}

	/* Avoid double lines if your theme adds cell borders */
	#table .tabulator-row .tabulator-cell {
	  border-bottom: 0 !important;
	}

	/* Optional: no border under the last row */
	#table .tabulator-row:last-child {
	  border-bottom: none !important;
	}

</style>

<body>
  <header class="topbar">
    <a href="index.html" class="home-btn" title="Go to Home">‚Üê Home</a>
  </header>

  <h1>Cluster Theme Classification</h1>

  <div class="controls">
    <input id="search" type="text" placeholder="Type to search">
    <select id="page-size">
      <option value="10">10 rows</option>
      <option value="25">25 rows</option>
      <option value="50">50 rows</option>
      <option value="100">100 rows</option>
    </select>
    <button id="download-xlsx">Download Excel</button>
    <button id="download-csv">Download CSV</button>
    <button id="clear">Clear filters</button>
  </div>

  <div id="table"></div>

<script>
// columns expect JSON keys: cluster_id, theme_id, explanation, title, abstract
const columns = [
  {title:"Cluster ID", field:"cluster_id", sorter:"number", headerFilter:"input", width:110, hozAlign:"center"},
  {title:"Theme ID",   field:"theme_id",   sorter:"number", headerFilter:"input", width:110, hozAlign:"center"},
  {
    title:"Explanation",
    field:"explanation",
    sorter:"string",
    headerFilter:"input",
    cssClass:"truncate-3",          // show 3 lines max
    formatter:"plaintext",
    tooltip: cell => (cell.getValue() || "").trim(),
    widthGrow:3
  },
  {
    title:"Title",
    field:"title",
    sorter:"string",
    headerFilter:"input",
    cssClass:"truncate-2",          // show 2 lines max
    formatter:"plaintext",
    tooltip: cell => (cell.getValue() || "").trim(),
    widthGrow:2
  },
  {
    title:"Abstract",
    field:"abstract",
    sorter:"string",
    headerFilter:"input",
    cssClass:"truncate-4",          // show 4 lines max
    formatter:"plaintext",
    tooltip: cell => (cell.getValue() || "").trim(),
    widthGrow:4
  },
];

const table = new Tabulator("#table", {
  height:"700px",
  layout:"fitDataStretch",
  ajaxURL:"aus_classification.json", // set to your exported JSON file
  pagination:true,
  paginationSize:10,
  paginationSizeSelector:[10,25,50,100],
  columns,
  rowHeight:64,          // compact rows (tweak as you like)
  variableHeight:false,  // keep rows fixed-height; long text is clamped
  columnDefaults:{ vertAlign:"top" }
});

// global search
const searchInput = document.getElementById("search");
searchInput.addEventListener("input", () => {
  const q = searchInput.value.trim();
  if (!q) { table.clearFilter(true); return; }
  const fields = columns.map(c => c.field);
  table.setFilter(fields.map(f => ({field:f, type:"like", value:q})), "or");
});

// page size
document.getElementById("page-size").addEventListener("change", e => {
  table.setPageSize(parseInt(e.target.value,10));
});

// downloads
document.getElementById("download-xlsx").addEventListener("click", () => {
  table.download("xlsx", "cluster_theme_classification.xlsx", {sheetName:"Data"});
});
document.getElementById("download-csv").addEventListener("click", () => {
  table.download("csv", "cluster_theme_classification.csv");
});

// clear filters
document.getElementById("clear").addEventListener("click", () => {
  searchInput.value = "";
  table.clearFilter(true);
});
</script>
</body>
</html>
