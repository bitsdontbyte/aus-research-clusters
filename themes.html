<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Postgres Table on GitHub Pages</title>

<link href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 16px; }
  .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
  #table { border: 1px solid #e5e7eb; }

  /* wrap long text in description cells */
  .tabulator-cell.wrap {
    white-space: normal !important;
    word-wrap: break-word;
    line-height: 1.4;
  }

  input, button, select { padding: 6px 10px; }
</style>

<body>
  <h1>Themes</h1>

  <div class="controls">
    <input id="search" type="text" placeholder="Type to search">
    <select id="page-size">
      <option value="10">10 rows</option>
      <option value="25">25 rows</option>
      <option value="50">50 rows</option>
      <option value="100">100 rows</option>
    </select>
    <button id="download-xlsx">Download Excel</button>
    <button id="download-csv">Download CSV</button>
    <button id="clear">Clear filters</button>
  </div>

  <div id="table"></div>

<script>
const columns = [
  {title:"cluster id", field:"cluster_id", sorter:"number", headerFilter:"input", width:120},
  {title:"theme id", field:"theme_id", sorter:"number", headerFilter:"input", width:120},
  {title:"name", field:"name", sorter:"string", headerFilter:"input", width:220},
  {
    title:"description",
    field:"description",
    sorter:"string",
    headerFilter:"input",
    cssClass:"wrap",
    formatter:"textarea",       // multi-line rendering
    widthGrow:3                 // give it more horizontal room
  },
];

const table = new Tabulator("#table", {
  height:"700px",
  layout:"fitDataStretch",
  ajaxURL:"aus_themes.json",
  pagination:true,
  paginationSize:10,
  paginationSizeSelector:[10,25,50,100],
  columns,
  // make tall cells expand; align text to top for readability
  columnDefaults:{ vertAlign:"top" },
  variableHeight:true
});

// global search
const searchInput = document.getElementById("search");
searchInput.addEventListener("input", () => {
  const q = searchInput.value.trim();
  if (!q) { table.clearFilter(true); return; }
  const fields = columns.map(c => c.field);
  table.setFilter(fields.map(f => ({field:f, type:"like", value:q})), "or");
});

// change page size
document.getElementById("page-size").addEventListener("change", e => {
  table.setPageSize(parseInt(e.target.value,10));
});

// downloads
document.getElementById("download-xlsx").addEventListener("click", () => {
  table.download("xlsx", "dataset.xlsx", {sheetName:"Data"});
});
document.getElementById("download-csv").addEventListener("click", () => {
  table.download("csv", "dataset.csv");
});

// clear filters
document.getElementById("clear").addEventListener("click", () => {
  searchInput.value = "";
  table.clearFilter(true);
});
</script>
</body>
</html>
